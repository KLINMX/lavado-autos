<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="AutoWash Pro ‚Äî Reservas. Experiencia futurista, fluida y premium." />
<title>AutoWash Pro ‚Äî Reservas</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --accent:#2563eb;
  --glass-bg: rgba(255,255,255,0.06);
  --card: rgba(255,255,255,0.03);
  --bg: linear-gradient(180deg,#0b1220 0%, #071128 100%);
  --muted: rgba(255,255,255,0.66);
  --text: #e6eefc;
  --success:#10b981;
  --danger:#ef4444;
  --radius:14px;
  --glass-blur: 10px;
  --neon: 0 8px 40px rgba(37,99,235,0.14);
  --smooth: 240ms cubic-bezier(.2,.9,.3,1);
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial; -webkit-font-smoothing:antialiased;}
body{
  background: var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
  line-height:1.45;
  font-size:16px;
  padding-bottom:120px;
}

/* Layout */
.container{max-width:980px;margin:20px auto;padding:20px}
.header{
  display:flex;align-items:center;justify-content:space-between;padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  box-shadow:var(--neon);
  border:1px solid rgba(255,255,255,0.03);
}
.brand{display:flex;align-items:center;gap:12px}
.logo{
  width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#1b4fcf);
  display:flex;align-items:center;justify-content:center;font-weight:800;color:white;font-size:18px;box-shadow:0 6px 30px rgba(37,99,235,0.18);
}
.brand h1{font-size:1rem;margin:0;font-weight:700}
.header-right{display:flex;gap:12px;align-items:center}

/* Card / glass */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius:16px;padding:18px;border:1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(var(--glass-blur)); box-shadow: 0 10px 40px rgba(2,6,23,0.6);
}

/* Flow */
.flow{display:grid;gap:14px}
.step-title{display:flex;align-items:center;gap:12px}
.step-num{width:36px;height:36px;border-radius:10px;background:linear-gradient(180deg,#0f1724,#1b2434);display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent);box-shadow:0 6px 18px rgba(37,99,235,0.06)}
.lead{color:var(--muted);margin:6px 0 0}

/* Services grid */
.services{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.svc{
  display:flex;align-items:center;gap:12px;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);
  cursor:pointer;transition: transform var(--smooth), box-shadow var(--smooth), border-color var(--smooth);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
}
.svc:hover{transform:translateY(-8px);box-shadow:0 20px 60px rgba(3,7,20,0.6);}
.svc.selected{border-color:rgba(37,99,235,0.6); box-shadow:0 30px 90px rgba(37,99,235,0.12); transform:translateY(-6px)}
.icon{width:54px;height:54px;border-radius:10px;background:linear-gradient(180deg,#081020,#0b1320);display:flex;align-items:center;justify-content:center;font-size:22px;color:var(--accent);box-shadow:inset 0 -8px 20px rgba(0,0,0,0.4)}

/* Dates horizontal */
.dates{display:flex;gap:8px;overflow:auto;padding:8px 2px}
.date{
  min-width:84px;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);text-align:center;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);cursor:pointer;
}
.date.selected{background:linear-gradient(135deg,#15305a,#0f1a33); border:1px solid rgba(37,99,235,0.6); color:var(--text); box-shadow:0 12px 40px rgba(19,53,110,0.28)}
.date:disabled{opacity:0.28;cursor:not-allowed}

/* Times */
.times{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:10px;margin-top:8px}
.time{padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);text-align:center;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);cursor:pointer}
.time.selected{background:linear-gradient(135deg,#0e2a5a,#07203a); border:1px solid rgba(37,99,235,0.6); color:var(--text)}

/* Form */
.form{display:grid;gap:10px}
label{font-weight:600;color:var(--text);margin-bottom:6px;display:block}
input, textarea{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
input::placeholder{color:rgba(255,255,255,0.5)}
.btn{
  background:linear-gradient(180deg,var(--accent),#1b4fcf);color:white;padding:12px 16px;border:none;border-radius:12px;font-weight:800;cursor:pointer;
  box-shadow:0 14px 40px rgba(37,99,235,0.12);transition:transform var(--smooth)
}
.btn:active{transform:translateY(1px)}

/* Bottom summary (mobile) */
.bottom-summary{
  position:fixed;left:18px;right:18px;bottom:24px;padding:12px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.03);box-shadow:0 30px 80px rgba(2,6,23,0.8);display:flex;justify-content:space-between;align-items:center;gap:12px;z-index:60;
}

/* Confirm overlay */
.overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(1,3,8,0.6),rgba(0,0,0,0.6));z-index:140}
.overlay.show{display:flex}
.confirm-modal{width:100%;max-width:520px;padding:18px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);box-shadow:0 40px 140px rgba(2,6,23,0.9);text-align:center}

/* QR square */
.qr{width:150px;height:150px;border-radius:12px;background:linear-gradient(180deg,#0b1326,#071028);display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.04)}

/* responsive */
@media(min-width:900px){
  .layout{display:grid;grid-template-columns: 1fr 340px;gap:20px}
  .bottom-summary{display:none}
}
</style>
</head>
<body>
  <div class="container">
    <header class="header card">
      <div class="brand">
        <div class="logo">AW</div>
        <div>
          <h1>AutoWash Pro</h1>
          <div style="color:var(--muted);font-size:0.92rem">Reservas ‚Äî futurista & premium</div>
        </div>
      </div>
      <div class="header-right">
        <div style="text-align:right;color:var(--muted)"><div id="statusText">Conectando...</div></div>
        <button id="adminOpen" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)">Admin</button>
      </div>
    </header>

    <main class="layout" style="margin-top:18px">
      <div class="flow">
        <!-- Step 1 -->
        <section class="card">
          <div class="step-title"><div class="step-num">1</div><div><h2>Selecciona tu servicio</h2><div class="lead">Simple, r√°pido y premium.</div></div></div>
          <div id="services" class="services" aria-live="polite" style="margin-top:12px"></div>
        </section>

        <!-- Step 2 -->
        <section class="card" id="cardDate" style="display:none">
          <div class="step-title"><div class="step-num">2</div><div><h2>Selecciona la fecha</h2><div class="lead">Disponibilidad pr√≥ximos 7 d√≠as.</div></div></div>
          <div id="dates" class="dates" style="margin-top:12px"></div>
        </section>

        <!-- Step 3 -->
        <section class="card" id="cardTime" style="display:none">
          <div class="step-title"><div class="step-num">3</div><div><h2>Elige el horario</h2><div class="lead">Los horarios ocupados se atenuan.</div></div></div>
          <div id="times" class="times" style="margin-top:12px"></div>
        </section>

        <!-- Step 4 -->
        <section class="card" id="cardForm" style="display:none">
          <div class="step-title"><div class="step-num">4</div><div><h2>Informaci√≥n de contacto</h2><div class="lead">Guardamos solo lo necesario.</div></div></div>
          <form id="bookingForm" class="form" novalidate>
            <div><label>Nombre completo</label><input id="name" type="text" placeholder="Juan P√©rez" required></div>
            <div><label>Tel√©fono</label><input id="phone" type="tel" inputmode="numeric" placeholder="4611234567" required></div>
            <div><label>Direcci√≥n</label><input id="address" type="text" placeholder="Av. Ju√°rez #123" required></div>
            <div><label>Veh√≠culo</label><input id="car" type="text" placeholder="Toyota Corolla 2020 - Blanco" required></div>
            <div style="display:flex;gap:10px;margin-top:8px"><button id="confirmBtn" class="btn" type="submit">Confirmar reservaci√≥n</button><div id="inlineLoading" style="display:none;color:var(--muted)">Procesando...</div></div>
          </form>
        </section>
      </div>

      <!-- Summary column -->
      <aside>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center"><div><div style="color:var(--muted)">Resumen</div><div style="font-weight:800;font-size:1.1rem" id="summaryService">‚Äî</div></div><div style="text-align:right"><div style="color:var(--muted)">Duraci√≥n</div><div id="summaryDuration">0 min</div></div></div>
          <div style="height:1px;background:rgba(255,255,255,0.03);margin:12px 0;border-radius:2px"></div>
          <div style="display:flex;justify-content:space-between"><div style="color:var(--muted)">Fecha / Hora</div><div id="summaryDateTime">‚Äî</div></div>
          <div style="height:1px;background:rgba(255,255,255,0.03);margin:12px 0;border-radius:2px"></div>
          <div style="display:flex;justify-content:space-between;align-items:center"><div style="color:var(--muted)">Total</div><div style="font-weight:900;font-size:1.4rem" id="summaryTotal">$0</div></div>
        </div>
      </aside>
    </main>
  </div>

  <!-- Bottom summary (mobile) -->
  <div class="bottom-summary card" id="bottomSummary" style="display:none">
    <div>
      <div id="sService" style="font-weight:800">‚Äî</div>
      <div style="color:var(--muted);font-size:0.9rem" id="sDateTime">‚Äî</div>
    </div>
    <div style="text-align:right">
      <div id="sPrice" style="font-weight:900">$0</div>
      <div style="color:var(--muted);font-size:0.9rem" id="sDuration">0 min</div>
    </div>
  </div>

  <!-- Confirmation overlay (Option 2) -->
  <div id="confirmOverlay" class="overlay" aria-hidden="true">
    <div class="confirm-modal card" role="dialog">
      <div style="display:flex;flex-direction:column;align-items:center;gap:12px">
        <div style="width:84px;height:84px;border-radius:16px;background:linear-gradient(135deg,var(--success),#059669);display:flex;align-items:center;justify-content:center;font-size:36px;color:white;font-weight:900">‚úì</div>
        <h3 id="confirmTitle" style="margin:0">Reservaci√≥n confirmada</h3>
        <p id="confirmText" style="color:var(--muted);margin:0">Tu reservaci√≥n se guard√≥ con √©xito.</p>

        <div class="qr" id="qrWrap"><img id="qrImage" alt="QR" style="width:100%;height:100%;object-fit:cover;border-radius:8px" /></div>

        <div style="display:flex;gap:12px;margin-top:8px">
          <button id="viewReceipt" class="btn">Ver recibo</button>
          <button id="newBooking" class="btn" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)">Nueva reservaci√≥n</button>
        </div>
      </div>
    </div>
  </div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
'use strict';

const firebaseConfig = {
  apiKey: "AIzaSyClriIvCnIc9ZgJrw08YNsfxtnECrQ6OFE",
  authDomain: "kl-n-12f7b.firebaseapp.com",
  databaseURL: "https://kl-n-12f7b-default-rtdb.firebaseio.com",
  projectId: "kl-n-12f7b",
  storageBucket: "kl-n-12f7b.firebasestorage.app",
  messagingSenderId: "941333228893",
  appId: "1:941333228893:web:3bbdb9ad91475ed3a2ccb4"
};

let app, database;
const state = { services: [], schedules: {}, bookings: [], selectedService: null, selectedDate: null, selectedTime: null, isConnected:false };
const DEFAULT_SERVICES = [
  { id:1, name:'B√°sico', description:'Lavado exterior + secado', price:80, time:30, icon:'üöó' },
  { id:2, name:'Completo', description:'Exterior + interior + aspirado', price:150, time:45, icon:'‚ú®' },
  { id:3, name:'Premium', description:'Completo + encerado', price:250, time:60, icon:'üíé' },
  { id:4, name:'Deluxe', description:'Detalle completo + pulido', price:350, time:90, icon:'üëë' }
];

const DEFAULT_SCHEDULES = {
  0:{active:false,start:'09:00',end:'15:00'},1:{active:true,start:'08:00',end:'18:00'},2:{active:true,start:'08:00',end:'18:00'},
  3:{active:true,start:'08:00',end:'18:00'},4:{active:true,start:'08:00',end:'18:00'},5:{active:true,start:'08:00',end:'18:00'},6:{active:true,start:'09:00',end:'15:00'}
};

function $(id){return document.getElementById(id)}
function escapeHtml(s){const d=document.createElement('div'); d.textContent=s; return d.innerHTML;}

function initFirebase(){
  try{
    app = firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    database.ref('.info/connected').on('value', snap => {
      state.isConnected = !!snap.val();
      $('statusText').textContent = state.isConnected ? 'Conectado' : 'Desconectado';
    });
    database.ref('services').on('value', snap => { state.services = snap.val() ? Object.values(snap.val()) : DEFAULT_SERVICES; renderServices(); });
    database.ref('schedules').on('value', snap => state.schedules = snap.val() || DEFAULT_SCHEDULES );
    database.ref('bookings').on('value', snap => state.bookings = snap.val() ? Object.values(snap.val()) : []);
    // ensure defaults
    database.ref('services').once('value', snap => { if(!snap.exists()) database.ref('services').set(DEFAULT_SERVICES); });
    database.ref('schedules').once('value', snap => { if(!snap.exists()) database.ref('schedules').set(DEFAULT_SCHEDULES); });
    // fallback render
    if(!state.services.length) { state.services = DEFAULT_SERVICES; renderServices(); }
  }catch(e){
    console.warn('Firebase fallback', e);
    state.services = DEFAULT_SERVICES; state.schedules = DEFAULT_SCHEDULES; renderServices();
  }
}

/* Renderers */
function renderServices(){
  const wrap = $('services');
  const services = state.services.length ? state.services : DEFAULT_SERVICES;
  wrap.innerHTML = services.map(s => `
    <div class="svc" data-id="${s.id}" role="button" tabindex="0">
      <div class="icon">${s.icon}</div>
      <div style="flex:1"><div style="font-weight:800">${escapeHtml(s.name)}</div><div style="color:var(--muted);font-size:0.9rem">${escapeHtml(s.description)}</div></div>
      <div style="text-align:right"><div style="font-weight:900">$${s.price}</div><div style="color:var(--muted);font-size:0.9rem">${s.time} min</div></div>
    </div>
  `).join('');
  document.querySelectorAll('.svc').forEach(el=>{
    el.addEventListener('click', ()=> selectService(Number(el.dataset.id), el));
    el.addEventListener('keydown', (e)=> { if(e.key==='Enter') selectService(Number(el.dataset.id), el); });
  });
}
function selectService(id, el){
  const services = state.services.length ? state.services : DEFAULT_SERVICES;
  const svc = services.find(s=>s.id===id);
  if(!svc) return;
  state.selectedService = svc;
  document.querySelectorAll('.svc').forEach(n=>n.classList.remove('selected'));
  el.classList.add('selected');
  $('cardDate').style.display = '';
  renderDates();
  updateSummary();
  el.scrollIntoView({behavior:'smooth',block:'center'});
}

function renderDates(){
  const wrap = $('dates'); wrap.innerHTML = '';
  const labels = ['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b'];
  for(let i=0;i<7;i++){
    const d = new Date(); d.setDate(d.getDate()+i); const dow = d.getDay();
    const schedule = state.schedules && state.schedules[dow] ? state.schedules[dow] : DEFAULT_SCHEDULES[dow];
    const disabled = !schedule || !schedule.active;
    const dateStr = d.toISOString().split('T')[0];
    const btn = document.createElement('button'); btn.className='date'; btn.dataset.date=dateStr;
    btn.innerHTML = `<div style="font-size:0.85rem;color:var(--muted)">${labels[dow]}</div><div style="font-weight:900;margin-top:6px">${d.getDate()}</div>`;
    if(disabled) btn.disabled=true;
    btn.addEventListener('click',()=> selectDate(dateStr, btn));
    wrap.appendChild(btn);
  }
}

function selectDate(dateStr, el){ state.selectedDate = dateStr; document.querySelectorAll('.date').forEach(d=>d.classList.remove('selected')); el.classList.add('selected'); $('cardTime').style.display=''; renderTimes(); updateSummary(); el.scrollIntoView({behavior:'smooth',block:'center'}); }

function renderTimes(){
  const wrap = $('times'); wrap.innerHTML=''; if(!state.selectedDate||!state.selectedService) return;
  const d = new Date(state.selectedDate + 'T00:00:00'); const dow = d.getDay();
  const schedule = state.schedules && state.schedules[dow] ? state.schedules[dow] : DEFAULT_SCHEDULES[dow];
  if(!schedule || !schedule.active){ wrap.innerHTML = `<div style="color:var(--muted)">No hay horarios disponibles</div>`; return; }
  const times = generateTimes(schedule.start,schedule.end);
  times.forEach(t=>{
    const btn=document.createElement('button'); btn.className='time'; btn.textContent=t; btn.dataset.time=t;
    btn.disabled = !isTimeAvailable(state.selectedDate,t);
    if(btn.disabled) btn.style.opacity=0.4;
    btn.addEventListener('click', ()=> selectTime(t, btn));
    wrap.appendChild(btn);
  });
}

function generateTimes(start,end,step=30){
  const out=[]; let [h,m]=start.split(':').map(Number); const [eh,em]=end.split(':').map(Number);
  let t = h*60 + m, endMin = eh*60 + em; while(t + 1 <= endMin){ const hh=Math.floor(t/60), mm=t%60; out.push(String(hh).padStart(2,'0')+':'+String(mm).padStart(2,'0')); t+=step; } return out;
}

function isTimeAvailable(date,time){
  if(!state.selectedService) return false;
  const start = new Date(date + 'T' + time);
  const end = new Date(start.getTime() + state.selectedService.time * 60000);
  if(start < new Date()) return false;
  return !state.bookings.some(b => { if(b.status==='cancelled') return false; if(b.date !== date) return false; const bStart = new Date(b.date + 'T' + b.time); const bEnd = new Date(bStart.getTime() + ((b.duration||state.selectedService.time)*60000)); return (start < bEnd && end > bStart); });
}

function selectTime(t, el){ state.selectedTime=t; document.querySelectorAll('.time').forEach(x=>x.classList.remove('selected')); el.classList.add('selected'); $('cardForm').style.display=''; updateSummary(); el.scrollIntoView({behavior:'smooth',block:'center'}); }

function updateSummary(){
  $('summaryService').textContent = state.selectedService ? state.selectedService.name : '‚Äî';
  $('summaryDuration').textContent = state.selectedService ? (state.selectedService.time + ' min') : '0 min';
  $('summaryDateTime').textContent = (state.selectedDate && state.selectedTime) ? (formatDate(state.selectedDate) + ' ¬∑ ' + state.selectedTime) : '‚Äî';
  $('summaryTotal').textContent = state.selectedService ? ('$' + state.selectedService.price) : '$0';
  const showBottom = !!state.selectedService; $('bottomSummary').style.display = showBottom ? '' : 'none';
  $('sService').textContent = state.selectedService ? state.selectedService.name : '‚Äî';
  $('sDateTime').textContent = (state.selectedDate && state.selectedTime) ? (formatDate(state.selectedDate) + ' ¬∑ ' + state.selectedTime) : '‚Äî';
  $('sPrice').textContent = state.selectedService ? ('$' + state.selectedService.price) : '$0';
  $('sDuration').textContent = state.selectedService ? (state.selectedService.time + ' min') : '0 min';
}

function formatDate(dStr){ const d=new Date(dStr + 'T00:00:00'); return d.toLocaleDateString('es-MX',{weekday:'short',day:'2-digit',month:'short'}); }

/* Booking submit */
let lastBookingId = null;
document.addEventListener('DOMContentLoaded', ()=>{
  initFirebase();
  $('bookingForm').addEventListener('submit', submitBooking);
  $('phone').addEventListener('input', ()=> $('phone').value = $('phone').value.replace(/\D/g,''));
  $('viewReceipt').addEventListener('click', ()=> { if(lastBookingId) window.location.href = 'recibo.html?id=' + encodeURIComponent(lastBookingId); });
  $('newBooking').addEventListener('click', ()=> { closeConfirm(); resetFlow(); });
  document.querySelector('#adminOpen').addEventListener('click', ()=> window.open('admin.html','_self'));
});

async function submitBooking(e){
  e.preventDefault();
  const name = $('name'), phone = $('phone'), address = $('address'), car = $('car');
  let ok = true;
  if(!name.value.trim() || name.value.trim().length < 2){ ok=false; name.style.borderColor='rgba(255,80,80,0.6)'; } else name.style.borderColor='';
  if(!/^[0-9]{10,15}$/.test(phone.value.replace(/\D/g,''))){ ok=false; phone.style.borderColor='rgba(255,80,80,0.6)'; } else phone.style.borderColor='';
  if(!address.value.trim() || address.value.trim().length<5){ ok=false; address.style.borderColor='rgba(255,80,80,0.6)'; } else address.style.borderColor='';
  if(!car.value.trim() || car.value.trim().length<3){ ok=false; car.style.borderColor='rgba(255,80,80,0.6)'; } else car.style.borderColor='';

  if(!state.selectedService || !state.selectedDate || !state.selectedTime){ showToast('Completa servicio, fecha y horario'); return; }
  if(!ok) return;
  if(!state.isConnected){ showToast('Sin conexi√≥n a la base de datos'); return; }

  if(!isTimeAvailable(state.selectedDate, state.selectedTime)){ showToast('Horario ya no disponible'); renderTimes(); return; }

  $('inlineLoading').style.display='inline-block'; $('confirmBtn').disabled=true;

  const booking = {
    service: state.selectedService.name,
    price: state.selectedService.price,
    duration: state.selectedService.time,
    date: state.selectedDate,
    time: state.selectedTime,
    name: name.value.trim(),
    phone: phone.value.replace(/\D/g,'').trim(),
    address: address.value.trim(),
    car: car.value.trim(),
    status: 'confirmed',
    createdAt: new Date().toISOString()
  };

  try{
    const ref = database.ref('bookings').push();
    booking.id = ref.key;
    await ref.set(booking);
    lastBookingId = booking.id;
    $('inlineLoading').style.display='none'; $('confirmBtn').disabled=false;

    const receiptUrl = location.origin + location.pathname.replace(/[^\/]*$/, '') + 'recibo.html?id=' + encodeURIComponent(booking.id);
    const qrUrl = 'https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=' + encodeURIComponent(receiptUrl);
    $('qrImage').src = qrUrl;

    $('confirmText').textContent = `Reservaci√≥n para ${booking.name} ¬∑ ${formatDate(booking.date)} ¬∑ ${booking.time} ¬∑ $${booking.price}`;
    openConfirm();
  }catch(err){
    console.error(err);
    $('inlineLoading').style.display='none'; $('confirmBtn').disabled=false; showToast('Error procesando reserva');
  }
}

/* UI helpers */
function openConfirm(){ $('confirmOverlay').classList.add('show'); $('confirmOverlay').style.display='flex'; $('confirmOverlay').setAttribute('aria-hidden','false'); }
function closeConfirm(){ $('confirmOverlay').classList.remove('show'); $('confirmOverlay').style.display='none'; $('confirmOverlay').setAttribute('aria-hidden','true'); }
function resetFlow(){ state.selectedService=null; state.selectedDate=null; state.selectedTime=null; document.getElementById('bookingForm').reset(); document.querySelectorAll('.svc,.date,.time').forEach(n=>n.classList.remove('selected')); $('cardDate').style.display='none'; $('cardTime').style.display='none'; $('cardForm').style.display='none'; updateSummary(); window.scrollTo({top:0,behavior:'smooth'}); }
function showToast(msg){ const t=document.createElement('div'); t.textContent=msg; t.style.position='fixed'; t.style.bottom='28px'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.background='linear-gradient(180deg,var(--accent),#1b4fcf)'; t.style.color='white'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.zIndex=9999; document.body.appendChild(t); setTimeout(()=> t.remove(),2500); }
</script>
</body>
</html>
